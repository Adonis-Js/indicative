"use strict";function prop(r,e){if("object"!=typeof r||"string"!=typeof e)return r;for(var n=e.split("."),t=0;t<n.length;t++){var i=n[t];if(null===(r=r.hasOwnProperty(i)?r[i]:null))break}return r}function pope(r,e,n){n=n||{skipUndefined:!1,throwOnUndefined:!1};for(var t,i=/{{2}(.+?)}{2}/g,o=r;null!==(t=i.exec(r));){var u=t[1].trim();if(u){var a=prop(e,u);if(void 0!==a&&null!==a)o=o.replace(t[0],a);else{if(n.throwOnUndefined){var s=new Error("Missing value for "+t[0]);throw s.key=u,s.code="E_MISSING_KEY",s}n.skipUndefined||(o=o.replace(t[0],""))}}}return o}function PLazy(r){this.fn=r,this._promise=null}function onResolved(r){return{fullFilled:!0,rejected:!1,value:r,reason:null}}function onRejected(r){return{fullFilled:!1,rejected:!0,value:null,reason:r}}function pSeries(r,e){function n(e,o){return e>=i?Promise.resolve(t):r[e].then(function(r){return t.push(onResolved(r)),n(e+1,o)}).catch(function(r){return t.push(onRejected(r)),o?Promise.resolve(t):n(e+1,o)})}var t=[],i=r.length;return n(0,e)}function Pipe(r,e){e.add();const n=r.length;let t=0,i="name";for(;t<n;){const n=r[t++],o=n.charCodeAt(0);58===o||44===o?(i="arg",e.shiftValue()):124===o?(i="name",e.add()):"arg"===i?e.appendValue(n):e.appendKey(n,o)}return e.toJSON()}function ArrayPresenter(){return{nodes:[],currentNode:null,add(){this.currentNode={name:"",args:[]},this.nodes.push(this.currentNode)},appendKey(r,e){32!==e&&(this.currentNode.name+=r)},appendValue(r){this.currentNode.args[this.currentNode.args.length-1]+=r},shiftValue(){this.currentNode.args.push("")},toJSON(){return this.nodes}}}function starToIndex(r,e,n,t){if(!e)return[];n=n||0;var i=r[n++],o=r[n];return t||(t=[i],i=""),t=t.reduce(function(r,n){var t=i?n+"."+i:n;if(void 0!==o){var u=prop(e,t);if(Array.isArray(u))for(var a=u.length,s=0;s<a;s++)r.push(t+"."+s)}else r.push(t);return r},[]),n===r.length?t:starToIndex(r,e,n,t)}function parseRules(r,e){return e=e||{},Object.keys(r).reduce(function(n,t){var i=r[t];if("string"==typeof i)i=hayePipe(i,new hayeArrayPresenter);else if(!Array.isArray(i))throw new Error("Rules must be defined as a string or an array");if(t.includes("*")){starToIndex(t.split(/\.\*\.?/),e).forEach(function(r){n[r]=i})}else n[t]=i;return n},{})}function getMessage(r,e,n,t){var i=r[(e=e.replace(/\.\d/g,".*"))+"."+n]||r[n]||"{{validation}} validation failed on {{ field }}";return"function"==typeof i?i(e,n,t):pope(i,{field:e,validation:n,argument:t})}function VanillaFormatter(){this.errors=[]}function validationFn(r,e,n,t,i,o){var u=e.name,a=e.args;return new PLazy(function(e,o){if("function"!=typeof r[u])throw new Error(u+" is not defined as a validation rule");var s=getMessage(i,n,u,a);r[u](t,n,s,a,prop).then(e).catch(o)}).catch(function(r){o.addError(r,n,u)})}function getValidationsStack(r,e,n,t,i){return Object.keys(e).reduce(function(o,u){return e[u].map(function(e){o.push(validationFn(r,e,u,n,t,i))}),o},[])}function _validate(r,e,n,t,i,o){return o=o||new VanillaFormatter,new Promise(function(u,a){i=i||{};var s=parseRules(t);pSeries(getValidationsStack(r,s,n,i,o),e).then(function(r){var e=o.toJSON();if(e.length)return a(e);u(n)})})}PLazy.prototype.then=function(r,e){return this._promise=this._promise||new Promise(this.fn),this._promise.then(r,e)},PLazy.prototype.catch=function(r){return this._promise=this._promise||new Promise(this.fn),this._promise.catch(r)};var hayePipe=Pipe,hayeArrayPresenter=ArrayPresenter;VanillaFormatter.prototype.addError=function(r,e,n){var t=r;r instanceof Error&&(n="ENGINE_EXCEPTION",t=r.message),this.errors.push({message:t,field:e,validation:n})},VanillaFormatter.prototype.toJSON=function(){return this.errors};var validator=function(r){return{validate:function(e,n,t,i){return _validate(r,!0,e,n,t,i)},validateAll:function(e,n,t,i){return _validate(r,!1,e,n,t,i)}}},toPromise=function(r){return new Promise(function(e,n){var t=r();if(t)return n(t);e("validation passed")})},existy=function(r){return"string"==typeof r?r.length>0:null!==r&&void 0!==r},skippable=function(r,e){return e?void 0===r:!existy(r)},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},slicedToArray=function(){return function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,e){var n=[],t=!0,i=!1,o=void 0;try{for(var u,a=r[Symbol.iterator]();!(t=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);t=!0);}catch(r){i=!0,o=r}finally{try{!t&&a.return&&a.return()}finally{if(i)throw o}}return n}(r,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),above=function(r,e,n,t,i){var o=slicedToArray(t,1)[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return Number(t)<=o?n:void 0})},truthy=function(r){return existy(r)&&!1!==r&&0!==r},accepted=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return truthy(t)?void 0:n})},alphaRegex=/^[a-z]+$/i,alpha$1=function(r){return alphaRegex.test(r)},alpha=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return alpha$1(t)?void 0:n})},alphaNumericRegex=/^[a-z0-9]+$/i,alphaNumeric$1=function(r){return alphaNumericRegex.test(r)},alphaNumeric=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return alphaNumeric$1(t)?void 0:n})},array=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return Array.isArray(t)?void 0:n})},boolean$1=function(r){return[!0,!1,0,1].indexOf(r)>-1},boolean=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return"0"===t?t=0:"1"===t&&(t=1),boolean$1(t)?void 0:n})},same=function(r,e){return r===e},confirmed=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return same(t,i(r,e+"_confirmation"))?void 0:n})},different=function(r,e,n,t,i){return toPromise(function(){var o=i(r,e);if(!skippable(o)){var u=i(r,t[0]);if(u)return u===o?n:void 0}})},emailRegex=/^([\w-]+(?:\.[\w-]+)*)(\+[\w.-]+)?@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i,email$1=function(r){return emailRegex.test(r)},email=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return email$1(t)?void 0:n})},endsWith=function(r,e,n,t,i){var o=slicedToArray(t,1)[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return String(t).endsWith(o)?void 0:n})},equals=function(r,e,n,t,i){var o=t[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return o!=t?n:void 0})},inArray=function(r,e){return"function"==typeof e.indexOf&&e.indexOf(r)>-1},_in=function(r,e,n,t,i){return toPromise(function(){var o=i(r,e);if(!skippable(o))return inArray(o,t)?void 0:n})},includes=function(r,e,n,t,i){var o=slicedToArray(t,1)[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return String(t).includes(o)?void 0:n})},integer=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return Number.isInteger(t)?void 0:n})},ipv4Regex=/^(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}$/,ipv4=function(r){return ipv4Regex.test(r)},ipv6Regex=/^(?:(?:[0-9a-fA-F:]){1,4}(?:(?::(?:[0-9a-fA-F]){1,4}|:)){2,7})+$/,ipv6=function(r){return ipv6Regex.test(r)},ip$1=function(r){return ipv4(r)||ipv6(r)},ip=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return ip$1(t)?void 0:n})},ipv4$1=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return ipv4(t)?void 0:n})},ipv6$1=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return ipv6(t)?void 0:n})},json$1=function(r){try{return!!(JSON.parse(r)||{})}catch(r){return!1}},json=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return json$1(t)?void 0:n})},max=function(r,e,n,t,i){var o=slicedToArray(t,1)[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return String(t).length>o?n:void 0})},min=function(r,e,n,t,i){var o=slicedToArray(t,1)[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return String(t).length<o?n:void 0})},notEquals=function(r,e,n,t,i){var o=t[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return o==t?n:void 0})},notIn=function(r,e,n,t,i){return toPromise(function(){var o=i(r,e);if(!skippable(o))return inArray(o,t)?n:void 0})},isNumber=function(r){return"number"==typeof r},number=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return isNumber(t)?void 0:n})},isObject=function(r){return r instanceof Object&&!Array.isArray(r)},object=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return isObject(t)?void 0:n})},between=function(r,e,n){return(r=Number(r))>Number(e)&&r<Number(n)},range=function(r,e,n,t,i){var o=slicedToArray(t,2),u=o[0],a=o[1];return toPromise(function(){if(!u||!a)return new Error("min and max values are required for range validation");var t=i(r,e);if(!skippable(t))return between(t,u,a)?void 0:n})},regex=function(r,e,n,t,i){var o=slicedToArray(t,2),u=o[0],a=o[1];return toPromise(function(){var t=i(r,e);if(!skippable(t)){return(u instanceof RegExp?u:new RegExp(u,a)).test(t)?void 0:n}})},empty=function(r){return!existy(r)||!(r instanceof Date)&&("object"===(void 0===r?"undefined":_typeof(r))&&0===Object.keys(r).length)},required=function(r,e,n,t,i){return toPromise(function(){if(empty(i(r,e)))return n})},requiredIf=function(r,e,n,t,i){return toPromise(function(){if(i(r,t[0]))return empty(i(r,e))?n:void 0})},requiredWhen=function(r,e,n,t,i){var o=slicedToArray(t,2),u=o[0],a=o[1];return toPromise(function(){var t=i(r,u);if(t&&a===t)return empty(i(r,e))?n:void 0})},requiredWithAll=function(r,e,n,t,i){return toPromise(function(){var o=0;if(t.forEach(function(e){i(r,e)&&o++}),o===t.length&&empty(i(r,e)))return n})},requiredWithAny=function(r,e,n,t,i){return toPromise(function(){for(var o=!1,u=0;u<t.length;u++)if(i(r,t[u])){o=!0;break}if(o&&empty(i(r,e)))return n})},requiredWithoutAll=function(r,e,n,t,i){return toPromise(function(){var o=0;if(t.forEach(function(e){i(r,e)||o++}),o===t.length&&empty(i(r,e)))return n})},requiredWithoutAny=function(r,e,n,t,i){return toPromise(function(){for(var o=!1,u=0;u<t.length;u++)if(!i(r,t[u])){o=!0;break}if(o&&empty(i(r,e)))return n})},same$1=function(r,e,n,t,i){return toPromise(function(){var o=i(r,e);if(!skippable(o)){var u=i(r,t[0]);if(u)return u!==o?n:void 0}})},startsWith=function(r,e,n,t,i){var o=slicedToArray(t,1)[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return String(t).startsWith(o)?void 0:n})},isString=function(r){return"string"==typeof r},string=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return isString(t)?void 0:n})},under=function(r,e,n,t,i){var o=slicedToArray(t,1)[0];return toPromise(function(){var t=i(r,e);if(!skippable(t))return Number(t)>=o?n:void 0})},urlRegex=/https?:\/\/(www\.)?([-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}|localhost)\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/i,url$1=function(r){return urlRegex.test(r)},url=function(r,e,n,t,i){return toPromise(function(){var t=i(r,e);if(!skippable(t))return url$1(t)?void 0:n})},validations=Object.freeze({above:above,accepted:accepted,alpha:alpha,alphaNumeric:alphaNumeric,array:array,boolean:boolean,confirmed:confirmed,different:different,email:email,endsWith:endsWith,equals:equals,in:_in,includes:includes,integer:integer,ip:ip,ipv4:ipv4$1,ipv6:ipv6$1,json:json,max:max,min:min,notEquals:notEquals,notIn:notIn,number:number,object:object,range:range,regex:regex,required:required,requiredIf:requiredIf,requiredWhen:requiredWhen,requiredWithAll:requiredWithAll,requiredWithAny:requiredWithAny,requiredWithoutAll:requiredWithoutAll,requiredWithoutAny:requiredWithoutAny,same:same$1,startsWith:startsWith,string:string,under:under,url:url}),above$1=function(r,e){return Number(r)>Number(e)},affirmative=function(r){return"A"===r||["yes","true","y","ok","okay"].indexOf(r.toLowerCase())>-1},array$1=function(r){return Array.isArray(r)},creditCardRegex=/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\d{3})\d{11})$/,creditCard=function(r){return r=r.replace(/-/g,""),creditCardRegex.test(r)},date=function(r,e){return r instanceof Date==!0||!e&&"Invalid Date"!==new Date(r).toString()},even=function(r){return Number(r)%2==0},falsy=function(r){return!truthy(r)},intersectAll=function(r,e){return!(!Array.isArray(r)||!Array.isArray(e))&&r.filter(function(r){return e.indexOf(r)>-1}).length===r.length},intersectAny=function(r,e){return!(!Array.isArray(r)||!Array.isArray(e))&&r.filter(function(r){return e.indexOf(r)>-1}).length>0},isFunction=function(r){return"function"==typeof r},positive=function(r){return Number(r)>=0},negative=function(r){return!positive(r)},isNull=function(r){return null===r},odd=function(r){return!even(r)},phoneRegex=/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/,phone=function(r){return phoneRegex.test(r)},regex$1=function(r,e){return e.test(r)},sameType=function(r,e){return(void 0===r?"undefined":_typeof(r))===(void 0===e?"undefined":_typeof(e))},sorted=function(r){if(!Array.isArray(r))return!1;for(var e=!1,n=0;n<r.length;){var t=r[n++],i=r[n-2];if(i&&i>t){e=!0;break}}return!e},under$1=function(r,e){return!above$1(r,e)},raw=Object.freeze({above:above$1,affirmative:affirmative,alpha:alpha$1,alphaNumeric:alphaNumeric$1,array:array$1,between:between,boolean:boolean$1,creditCard:creditCard,date:date,email:email$1,empty:empty,even:even,existy:existy,falsy:falsy,inArray:inArray,intersectAll:intersectAll,intersectAny:intersectAny,ip:ip$1,ipv4:ipv4,ipv6:ipv6,isFunction:isFunction,json:json$1,negative:negative,isNull:isNull,isNumber:isNumber,isObject:isObject,odd:odd,phone:phone,positive:positive,regex:regex$1,same:same,sameType:sameType,sorted:sorted,isString:isString,truthy:truthy,under:under$1,url:url$1}),validatorInstance=validator(validations),index={validate:validatorInstance.validate,validateAll:validatorInstance.validateAll,is:raw};module.exports=index;
