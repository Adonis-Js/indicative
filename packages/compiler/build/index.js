!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["indicative.parser"]=t():e["indicative.parser"]=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e,t){return`${t} validation failed on ${e}`}Object.defineProperty(t,"__esModule",{value:!0}),t.dotProp=function(e,t,r){for(let n=0;n<r&&null!==(e=e[t[n]]||null);n++);return e},t.defaultMessage=n,t.reportError=function(e,t,r,n,o,a){let s="",i="";s=a.arrayPaths&&a.arrayIndexes?a.arrayPaths.map((e,t)=>e.concat([a.arrayIndexes[t]]).join(".")).concat(o).concat(t).join("."):o.concat(t).join("."),i="function"==typeof n?n(s,r.name,r.args):n,e.addError(i,s,r.name,r.args)},t.isObject=function(e){return e&&e.constructor===Object},t.isArray=function(e){return e&&Array.isArray(e)},t.getItemsForIndex=function(e,t){return"*"===t?e:e[t]?[e[t]]:[]},t.getMessageFromPath=function({fields:e,rules:t},r,o,a){const s="*"===r?a.join("."):a.concat([r]).join(".");let i=n;return e[s]&&e[s][o.name]?i=e[s][o.name]:t[o.name]&&(i=t[o.name]),i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);t.validationCompiler=n.validationCompiler},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),o=r(4),a=r(0),s=r(5),i=r(6),c=r(7),u=(e,t,r,[n,o],s,i)=>{const u=n[e.name];if(!u)throw new Error(`${e.name} is not registered as a validation`);"function"==typeof u.compile&&(e.args=u.compile(e.args));const l=a.getMessageFromPath(o,t,e,i.concat(s)),d=new c.ValidationRunner(u,t,e,l,r,s);return u.async?{async:!0,fn:d.execAsync.bind(d)}:{async:!1,fn:d.exec.bind(d)}},l=(e,t,r)=>{const n=new i.ArrayRunner(e,t,r);return e.find(e=>e.async)?{async:!0,fn:n.execAsync.bind(n)}:{async:!1,fn:n.exec.bind(n)}};t.validationCompiler=function(e,t,r){const a=n.rulesParser(e),i=n.messagesParser(r),c=o.astWalker(a,[t,i],u,l),d=new s.FinalRunner(c);return d.exec.bind(d)}},function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.rulesParser=n.rulesParser,t.messagesParser=n.messagesParser},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),o=r(3);t.rulesParser=function(e){return Object.keys(e).reduce((t,r)=>{const a=e[r];let s=[];if(!a)throw new Error(`make sure to define rules for ${r}`);return s="string"==typeof a?new n(a,new o):a,function e(t,r,n,o=0){const a=t[o++],s=t.length===o,i=/^\d+$/.test(t[o]),c="*"===t[o]||i;return"*"===a||/^\d+$/.test(a)?s?void(n.each[a].rules=r):e(t,r,n.each[a].children,o):s?void function(e,t,r){const n=e[t]||{type:"literal"};n.rules=r,e[t]=n}(n,a,r):e(t,r,c?function(e,t,r){if(e[t]&&"object"===e[t].type)throw new Error(`cannot reshape ${t} object to an array`);const n=e[t]||{rules:[]};return n.each=n.each||{},n.each[r]=n.each[r]||{children:{},rules:[]},n.type="array",e[t]=n,n}(n,a,i?t[o]:"*"):function(e,t){if(e[t]&&"array"===e[t].type)throw new Error(`cannot reshape ${t} array to an object`);const r=e[t]||{rules:[]};return r.type="object",r.children=r.children||{},e[t]=r,r}(n,a).children,o)}(r.split("."),s,t),t},{})},t.messagesParser=function(e){return Object.keys(e).reduce((t,r)=>{const n=e[r],o=r.split("."),a=o.pop();if(!o.length)return t.rules={[a]:n},t;const s=o.join(".");return t.fields[s]=t.fields[s]||{},t.fields[s][a]=n,t},{fields:{},rules:{}})}},function(e,t,r){"use strict";e.exports=function(e,t){t.add();for(var r=e.length,n=0,o="name";n<r;){var a=e[n++],s=a.charCodeAt(0);58===s||44===s?(o="arg",t.shiftValue()):124===s?(o="name",t.add()):"arg"===o?t.appendValue(a):t.appendKey(a,s)}return t.toJSON()}},function(e,t,r){"use strict";e.exports=function(){return{nodes:[],currentNode:null,add:function(){this.currentNode={name:"",args:[]},this.nodes.push(this.currentNode)},appendKey:function(e,t){32!==t&&(this.currentNode.name+=e)},appendValue:function(e){this.currentNode.args[this.currentNode.args.length-1]+=e},shiftValue:function(){this.currentNode.args.push("")},toJSON:function(){return this.nodes}}}}])},function(e,t,r){"use strict";function n(e,t,r,o,a=[],s=[]){return Object.keys(e).reduce((i,c)=>{const u=e[c];return"literal"===u.type&&(i=i.concat(function(e,t,r,n,o,a){return e.rules.map(e=>n(e,t,"literal",r,o,a))}(u,c,t,r,a,s))),"object"===u.type&&(i=i.concat(function(e,t,r,o,a,s,i){let c=[];e.rules.length&&(c=e.rules.map(e=>o(e,t,"object",r,s,i))),s=s.concat(t);const u=n(e.children,r,o,a,s,i);return c=c.concat(u)}(u,c,t,r,o,a,s))),"array"===u.type&&(i=i.concat(function(e,t,r,o,a,s,i){let c=[];e.rules.length&&(c=e.rules.map(e=>o(e,t,"array",r,s,i))),s=s.concat(t);const u=Object.keys(e.each).reduce((t,c)=>{let u=[];e.each[c].rules.length&&(u=n({"arr:literal":{type:"literal",rules:e.each[c].rules}},r,o,a,[],i.concat(s).concat(c)));const l=n(e.each[c].children,r,o,a,[],i.concat(s).concat(c));return t.push(a(u.concat(l),s,c)),t},[]);return c=c.concat(u)}(u,c,t,r,o,a,s))),i},[])}Object.defineProperty(t,"__esModule",{value:!0}),t.astWalker=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FinalRunner=class{constructor(e){this._stack=e}async exec(e,t,r,n=!0){const o={original:e};for(let a of this._stack){let s=!1;if(s=a.async?await a.fn(e,t,o,r,n):a.fn(e,t,o,r,n),n&&!s)break}const a=t.toJSON();if(a)throw a;return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.ArrayRunner=class{constructor(e,t,r){this._executors=e,this._dotPath=t,this._index=r,this._dotPathLength=this._dotPath.length}_getRoot(e,t){return{arrayPaths:(e.arrayPaths||[]).concat([this._dotPath]),arrayIndexes:e.arrayIndexes||[],original:e.original,parentArray:t}}_updateIndexes(e,t){return{original:e.original,arrayIndexes:e.arrayIndexes.concat([t]),parentArray:e.parentArray,arrayPaths:e.arrayPaths,currentIndex:t}}_runExecutors(e,t,r,n,o,a){let s=!0;for(let i of this._executors)if(i.fn(e,t,this._updateIndexes(r,n),o,a)||(s=!1),!s&&a)break;return s}async _runAsyncExecutors(e,t,r,n,o,a){let s=!0;for(let i of this._executors){let c=!1;if((c=i.async?await i.fn(e,t,this._updateIndexes(r,n),o,a):i.fn(e,t,this._updateIndexes(r,n),o,a))||(s=!1),!s&&a)break}return s}exec(e,t,r,o,a){const s=n.dotProp(e,this._dotPath,this._dotPathLength);if(!n.isArray(s))return!0;const i=n.getItemsForIndex(s,this._index);if(!i.length)return!0;const c=this._getRoot(r,s);let u=!1,l=0;for(let e of i){if(!(u=this._runExecutors(e,t,c,l,o,a))&&a)break;l++}return u}async execAsync(e,t,r,o,a){const s=n.dotProp(e,this._dotPath,this._dotPathLength);if(!n.isArray(s))return!0;const i=n.getItemsForIndex(s,this._index);if(!i.length)return!0;const c=this._getRoot(r,s);let u=!1,l=0;for(let e of i){if(!(u=await this._runAsyncExecutors(e,t,c,l,o,a))&&a)break;l++}return u}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.ValidationRunner=class{constructor(e,t,r,n,o,a){this._validation=e,this._field=t,this._rule=r,this._message=n,this._type=o,this._dotPath=a,this._dotPathLength=this._dotPath.length}_reportError(e,t,r){n.reportError(e,this._field,this._rule,r||this._message,this._dotPath,t)}_runValidation(e,t,r){let o=n.dotProp(e,this._dotPath,this._dotPathLength);return"arr:literal"===this._field&&(o={[this._field]:o}),!n.isObject(o)||this._validation.validate(o,this._field,this._rule.args,this._type,t,r)}exec(e,t,r,n){try{const o=this._runValidation(e,r,n);return o||this._reportError(t,r),!!o}catch(e){return this._reportError(t,r,e),!1}}async execAsync(e,t,r,n){try{const o=await this._runValidation(e,r,n);return o||this._reportError(t,r),!!o}catch(e){return this._reportError(t,r,e),!1}}}}])});