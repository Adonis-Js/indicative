!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n.indicative=n.indicative||{},n.indicative.validator=e())}(this,function(){"use strict";function n(n,e){if(!function(n){return null!==n&&"object"==typeof n}(n)||"string"!=typeof e)return n;for(var r=e.split("."),t=0;t<r.length;t++){var i=r[t];if(null===(n=n.hasOwnProperty(i)?n[i]:null))break}return n}function e(n){this.fn=n,this._promise=null}function r(e,t,i,o){if(!t)return[];i=i||0;var u=e[i++],a=e[i];return o||(o=[u],u=""),o=o.reduce(function(e,r){var i=u?r+"."+u:r;if(void 0!==a){var o=n(t,i);if(Array.isArray(o))for(var f=o.length,s=0;s<f;s++)e.push(i+"."+s)}else e.push(i);return e},[]),i===e.length?o:r(e,t,i,o)}function t(e,r,t,i){var o=e[(r=r.replace(/\.\d/g,".*"))+"."+t]||e[t]||"{{validation}} validation failed on {{ field }}";return"function"==typeof o?o(r,t,i):function(e,r,t){t=t||{skipUndefined:!1,throwOnUndefined:!1};for(var i,o=/{{2}(.+?)}{2}/g,u=e;null!==(i=o.exec(e));){var a=i[1].trim();if(a){var f=n(r,a);if(void 0!==f&&null!==f)u=u.replace(i[0],f);else{if(t.throwOnUndefined){var s=new Error("Missing value for "+i[0]);throw s.key=a,s.code="E_MISSING_KEY",s}t.skipUndefined||(u=u.replace(i[0],""))}}}return u}(o,{field:r,validation:t,argument:i})}function i(r,i,o,u,a){return Object.keys(i).reduce(function(f,s){return i[s].map(function(i){f.push(function(r,i,o,u,a,f){var s=i.name,c=i.args;return new e(function(e,i){if("function"!=typeof r[s]){var l=new Error(s+" is not defined as a validation rule");return f.addError(l,o,s),void i(l)}var d=t(a,o,s,c);r[s](u,o,d,c,n).then(e).catch(function(n){f.addError(n,o,s),i(n)})})}(r,i,s,o,u,a))}),f},[])}function o(n,e,t,o,f,s){return new Promise(function(c,l){f=f||{};var d=function(n,e){return e=e||{},Object.keys(n).reduce(function(t,i){var o=n[i];if("string"==typeof o)o=u(o,new a);else if(!Array.isArray(o))throw new Error("Rules must be defined as a string or an array");return i.includes("*")?r(i.split(/\.\*\.?/),e).forEach(function(n){t[n]=o}):t[i]=o,t},{})}(o);(function(n,e){function r(e,o){return e>=i?Promise.resolve(t):n[e].then(function(n){return t.push(function(n){return{fullFilled:!0,rejected:!1,value:n,reason:null}}(n)),r(e+1,o)}).catch(function(n){return t.push(function(n){return{fullFilled:!1,rejected:!0,value:null,reason:n}}(n)),o?Promise.resolve(t):r(e+1,o)})}var t=[],i=n.length;return r(0,e)})(i(n,d,t,f,s),e).then(function(n){var e=s.toJSON();if(e.length)return l(e);c(t)})})}e.prototype.then=function(n,e){return this._promise=this._promise||new Promise(this.fn),this._promise.then(n,e)},e.prototype.catch=function(n){return this._promise=this._promise||new Promise(this.fn),this._promise.catch(n)};var u=function(n,e){e.add();const r=n.length;let t=0,i="name";for(;t<r;){const r=n[t++],o=r.charCodeAt(0);58===o||44===o?(i="arg",e.shiftValue()):124===o?(i="name",e.add()):"arg"===i?e.appendValue(r):e.appendKey(r,o)}return e.toJSON()},a=function(){return{nodes:[],currentNode:null,add(){this.currentNode={name:"",args:[]},this.nodes.push(this.currentNode)},appendKey(n,e){32!==e&&(this.currentNode.name+=n)},appendValue(n){this.currentNode.args[this.currentNode.args.length-1]+=n},shiftValue(){this.currentNode.args.push("")},toJSON(){return this.nodes}}};return function(n,e){var r="Cannot instantiate validator without";if(!n)throw new Error(r+" validations");if(!e)throw new Error(r+" formatters");return{validate:function(r,t,i,u){return u=new e[u||"Vanilla"],o(n,!0,r,t,i,u)},validateAll:function(r,t,i,u){return u=new e[u||"Vanilla"],o(n,!1,r,t,i,u)}}}});
